# fr24stats

## Сборка исполняемого файла

### Локально

- скачать и установить [Golang](https://go.dev/)
- склонировать проект

```bash
git clone https://github.com/yolkin256/fr24stats.git
```

- выполнить:

```bash
make
```

Приложение будет скомпилировано в файл `bin/app` для вашей архитектуры (на данный момент `cli`-приложение, далее может
появиться серверная часть с API для потребителей данных).

### Docker

- TBD

## Создание структуры директорий

- создать требуемую структуру директорий (*либо взять текущую структуру данного проекта*), например

```
. (/path/to/fr24stats)
├── bin
│    └── app                    <- исполняемый файл
├── data                        <- директория с данными
│    └── database.sqlite        <- файл БД
└── .env                        <- файл с переменными окружения
```

Файл с переменными окружения можно скопировать из заготовленного:

```bash
cp .env.dist .env
```

## Запуск

### Подготовка окружения

Убедиться, что `.env`-файл присутствует в директории приложения. На текущий момент требуется одна переменная
окружения `FR24_STATS_DB`, значение которой - относительный или абсолютный путь к файлу БД SQLite3.

### Подготовка БД

Для функционирования приложения необходимо подготовить БД, для этого запускаем миграции командой:

```bash
bin/app migrate
```

Должно быть выведено сообщение об успешно примененных миграциях вроде:

```
$ bin/app migrate

2024/01/29 20:52:40 [INFO]  Запуск миграций
2024/01/29 20:52:40 [INFO]  OK   20240128181121_init.sql (4.1ms)
2024/01/29 20:52:40 [INFO]  goose: successfully migrated database to version: 20240128181121
2024/01/29 20:52:40 [INFO]  Операция завершена
```

### Проверка (запуск сбора данных об авиалиниях)

```bash
bin/app scrape --airline=AFL
```

Есть возможность указать подробный вывод с ключом `-v` (`--verbose`):

```bash
bin/app scrape --airline=AFL -v
```

На данный момент команда сбора данных принимает одну авиалинию, если необходимо получать по нескольким, можно
добавить [cron](example.crontab)-файл в вашу систему. Важно не делать много запросов с одного адреса в единицу времени,
fr24 из-за этого может на какое-то время ограничить доступ.
